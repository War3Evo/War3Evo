1.2.3


9/20/2012

B9
//El Diablo
Major fix!

I added a 5 second delay to the refreshCategories() in the OnMapStart() section of War3Source_Engine_MenuChangerace.sp

This has fixed the stack errors I get when trying to load the whole svn folder, including SH stuff.  I used to run without the SH stuff (basically I don't use it), but decided today I needed to make sure everything runs together just fine.  So I looked for a solution to a longtime problem... Stack errors.  The War3Source_Engine_MenuChangerace.sp was refreshing the Categories so fast, it leaves not much room for sourcemod to load anything else.. causing stack errors.

Other than TF2 having a slightly minor problem with War3Source_Addon_ClanBonusXP.sp, this version of War3Source is very stable.


B8
//El Diablo
Added "Buyprevious" say command (Same as War3_RestoreItemsFromDeath except it works as a say command)
- Buyprevious is a player say command that allows players to auto buy all items
- they had from a previous death.  It will not be charged for the items they already own
- that matches the list from a previous death.
/**
 * When a player dies, this command record's their shopmenu1 items.
 * When you use this command, you are telling it to restore their items from death.
 * It does all the math as far as taking gold or cs money for items restored.
 * It will let the client know what items are discarded and/or bought.
 * It will also only buy until the client goes broke.
 * If the client already owns some items from the list from death, it will not charge them.
 * It only charges for the items that the client must buy to match the items from death.
 * It discards items that does not match from the previous death list.
 * Note: The no cost method still needs work.
 * @param client: Client index
 * @param payforit: false = no cost, true = charge
 * @param csmoney: true is cs money, false for gold.
 * @return The return value will be true if it is successful.
 */
native War3_RestoreItemsFromDeath(client,bool:payforit=true,bool:csmoney=false);


Added:

enum W3Buff
-bImmunity_Items

stock bool:W3HasImmunity(client,War3Immunity:immunityindex)

added:
	if(immunityindex==Immunity_Items){
		return W3GetBuffHasTrue(client,bImmunity_Items);
	}

Yes now you can check for immunity to items! Hurray!

enum W3EVENT
-DoShowPlayerItemsOwnTarget, ///EventArg1 = target = the person whos items is shown, client=SHOW TO

For your war3source.cfg:
/*
*  1 = Allows a player to Show the list of items a target player owns when a the player uses the say command "playerinfo" [default]
*  0 = Does not allow a player to Show the list of items a target player owns when a the player uses the say command "playerinfo"
*/
war3_show_playerinfo_other_player_items 1  //0 disables showing other players items using playerinfo. [default 1]

Players can now see only their list of items by using the say command "myitems"


B7

full invis player in CSS, weapon attachment are invisible.

RACE twilight sparkle
Buffhelper simple buff implemented, applys buff for simple duration

war3_bot_set_races 1 // should plugins set races for bots
SH cooldown error fix 

GENERIC SKILLS
Individual skill translations now possible (one skill is translated while others arn't)

Luna ult was not labled as an ult

Some Undead Balance
say speed in TF2 will print multiplier too
RACE: Rainbow dash
RACE: Twilight Sparkle

gamedata removed and CS drop weapon now uses SM native

fixed NAIX not leeching on kill when not in ducking mode.
fixed NAIX level 1 leech at 50% instead of 5%
fixed gold exceeding maxgold on kill
fixed NAIX automatically gaining additional hp from skill, 
-skill now only increases additional hp from leeching via skill and does not modify actual maxhp via buff engine

Buff HP fix
Race restrictions bug, setting limit to 1 resetted all players when limit is reached

Minor warnings fixes

Check race on xp/gold give, show changerace if they dont have a race

Shop2 access flag
CSGO compatability

Naris: Changed hint engine to a more simple object model instead of using tries (may or may not reach handle limit)

Glider: Award XP on TF2 for destroying buildings, also don't let engis get xp for using their own teleporter and change the hardcoded 1k distance for teleporters to reward xp to a cvar

Revan: cs:go compatibility of races has been improved(sounds and sfx fixed) + made warden uses Mole skill on CS:GO

Blood Hunter Fire loop on victims fixed (no blood crazy if player is on fire??)

Addon: Goldbets

Quick defines
so you can if(GAMECS){ }
#define GAMECS GameCS()
#define GAMETF GameTF()
#define GAMEL4D1 GameL4D1()
#define GAMEL4D2 GameL4D2()
#define GAMEL4DAny GameL4DAny()
#define GAMECSGO GameCSGO()

night elf evasion reduced to 15% max

war3_chancemodifier_sentry and war3_chancemodifier_sentryrocket cvars added back
None to use attack rate dependent chance modifier. Set from 0.0 to 1.0 chance modifier for sentry, this will override time dependent chance modifier

Bash chance modifier fixed

B6

death message blocking in the same frame. (SM will attempt to block the second message)
optimized succubus hunter
succubus headhunter changed to 100% chance to deal 0-20% damage (0-20 skulls). same applies to melee.
(succb translations changed, please re-translate for headhunter)

ValidPlayer(client,true,true) for checking alive via health also, useful for DamagePostHurt. this avoids double player score
claws and succubus now use this new method to check for "alive" to avoid double kill message. (DONT DEAL DAMAGE IF THEY ARE ALREADY DEAD)


NEW RACE: FLUTTERSHY
NEW RACE: RARITY
Dragonborn scales armor reduced to 3
fixed dragonborn roar immunity check to skills (was on ultimate)
NEW RACE: LUNA (ponified name pending) MADE BY REVAN

Cooldown engine will no longer print X seconds remaining if do not print on expire flag is set
War3_DealDamage reverted to entity type to allow custom weapon name for death message


B5
//ownz
dark elf gravity leak
translation fixes


class restrictions. MAXIMUM OF 2 classes. 
IF YOU DONT LIKE THIS LIMIT, SUGGEST CHANGES TO THE RACE, 
or i will come to your house and blow your greedy brains out.
war3 undead_restrictclass "spy"

race restrict checking moved from changerace to race restrictions engine
checks on join and spawn

checks for race on spawn and will give changerace menu if they dont have a race

forward changes:
forward OnWar3EventPostHurt(victim,attacker,dmgamount,[[[[[[[bool:isWarcraft]]]]]]]);
forward OnWar3EventDeath(victim,attacker,[[[[[[[deathrace]]]]]]]);
//Necavi

Note: not all of this is guaranteed to work on TF2, please contact me if you have any issues, and I'll fix them immediately.

Began expanding the Buff System:

fDodgeChance, //Registers a chance to dodge,
	
fVampirePercent, //Sets a % of damage done to give back as health
	
fBashChance, //Registers a chance to bash,
iBashDamage, //Does a certain amount of damage when you bash an enemy (more similar to warcraft 3's bash, default 0)
iBashDuration, //Sets the duration of bash's stun
	
fCritChance, //Registers a chance to crit,
iCritMode, //Default -1 (Set above this to enable) 1 (all damage qualifies for crit) 2 (bullet damage crit) 3 (grenade damage crit) 4 (melee damage crit) 5 (melee and bullet crit) 6 (melee and grenade crit) 7 (bullet and grenade crit)
fCritModifier, //Sets the critical strike modifer, default 1.0
iDamageMode, //Default -1 (Set above this to enable) 1 (all damage qualifies for damage increase) 2 (bullet damage damage increase) 3 (grenade damage damage increase) 4 (melee damage damage increase) 5 (melee and bullet damage increase) 6 (melee and grenade damage increase) 7 (bullet and grenade damage increase)

iDamageBonus, //Gives a direct increase to damage done
fDamageModifier, //Gives a % increase to damage done
	
MaxBuffLoopLimitTemp, //this is a variable that is for loops, this number is automatically generated fromt the enum. 

New Forwards: 
//Fired after a player dodges, useful primarily for attaching effects
forward OnW3DodgePost(victim,attacker);

//Fired before a player dodges, you can edit the dodge chance here
forward OnW3DodgePre(victim,attacker,Float:chance);

New Natives:

native War3_SuicideBomber(client, Float:location[], Float:damage, Float:radius, bool:effect=true);

native bool:War3_Teleport(client, Float:distance);

Big thanks to Invalid for his help on this one!
/**
 * Creates a ward.
 * 
 * Odd/special cases:
 * If a ward is created with selfInflict=false, but affinity=SELF_ONLY, you get a ward that does nothing, essentially.
 * If a ward is created with a negative/zero duration, it will last until map change or until it is removed manually.
 * 
 * @param client: owner id
 * @param location: ward location
 * @param radius: ward effect radius
 * @param duration: ward duration. If negative or zero, duration is infinite (until map change). Don't forget to remove the ward!
 * @param pulseInterval: time between effect triggerings
 * @param damage: amount of damage/healing done per interval
 * @param healing: whether or not this ward heals
 * @param selfInflict: whether or not this ward applies effects to its owner
 * @param affinity: the targeting affinity for this ward. ENEMIES, ALLIES, ALL, or SELF_ONLY
 * @return ID for the ward created or -1 if the ward was not created
 */
native _:War3_CreateWard(client, Float:location[], radius, Float:duration, Float:pulseInterval, damage, bool:healing=false, bool:selfInflict=false, War3WardAffinity:affinity=ENEMIES);

/**
 * Removes a ward given an id
 * @param id: ward id
 * @return True if the ward was removed. False otherwise
 */
native bool:War3_RemoveWard(id);


Recoded Undead Scourge and Human Alliance to use these new natives, forwards, and buffs, reducing the code in each file by ~75%!
More Buffs/Natives/Forwards are coming!




//Ownz
	

War3_GetSkillLevel now automatically accounts for current race. 
this allows the programmer to skip War3_GetRace(client)==thisRaceid and directly test for the skill level instead
example http://goo.gl/S0g0O //note the commented out sections // and /* */ in the red and green areas
WARNING: if your race prints silence, ult not leveled, etc, you still have to check for race 
because we don't want 100 races printing the same thing at the same time

War3_SetSkillLevel has been replaced with War3_GetSkillLevelINTERNAL (no race uses this anyway, this is internal stuff)
War3_GetSkillLevelINTERNAL is the old style getting skill level (persistance level value thats stored with the database)

forward OnSkillLevelChanged(client,race,skill,newskilllevel);
will now forward on a skill change, with the old race having the newskilllevel of 0
(zeros out the "apparrent" skill level of that race) 
and the new race's skill level's come subsequently. 

shopmenu2 workaround:
<dvander> DarkEnergy, the problem is that there are two memory management systems competing, Handles and explicit C++, and at the intersection there is a bug in the menu code
<dvander> that is rather complicated
<dvander> so you get a double-free
<dvander> DarkEnergy, you could work around this by cheating a little
<dvander> DarkEnergy: HandleSecurity sec(myself, myself);
<dvander> handlesys->FreeHandle(menu->GetHandle(), &sec);
<dvander> to totally prevent leaks, you'll want something a little more accurate:
<dvander> if (menu->GetHandle() == BAD_HANDLE) {
<dvander>     menu->Destroy();
<dvander> } else {
<dvander>     handlesys->FreeHandle(menu->GetHandle(), &sec);
<dvander> }
<dvander> to make sure i got the security line right, youll want to make sure that handlesys actually returns a non-error value
 
B4

skill registration no longer requires "false,4);" to specify the skill is NOT and ultimate and has 4 levels, these are now default parameters
test

Setting max health is no longer allowed, it should be done within the buff system.
Fixed issues where max health was much more than it was suppose to.

new EVENT:OnBuffChanged allows us to respond when a buff changes
public OnWar3Event(W3EVENT:event,client){
if(event==OnBuffChanged)
{
if(W3GetVar(EventArg1)==iAdditionalMaxHealth&&ValidPlayer(client,true)){.....


B3 / Rev530
shop2 items translated (THANKS)
fixed shop2 non existant natives
shop2 translations begin with w3s.item2. instead of w3s.item
hint and cooldown engine now checked by system check in case of handle leaks
FIXED a hint handle leak
fix scout vanish leaking into next spawn
fixed a swap argument in W3HasAura (facehoof)
itemsinfo2
playerinfo shows shop2 items
playerinfo <argument> automatically makes a menu with client's names that match the argument

B2

Hint engine fix: automatically force refresh after spawn
New addon: automatically buy item if their gold is at maximum at spawn
("war3_autobuy_on_max_gold","lace","automatically buy this item if their gold is full");
//thanks for translating this

some natives exposed

TF2: invis tf_wearables too!!!! and exceptions like tf_wearables_demoshield.
if you find a weapon that doesnt invis, search for it in server console: "find_ent tf_wear" and paste the result or find the item.

*note "Cannot Invis. Being revealed" needs translating in Engine_BuffSpeedGravGlow

Fixed extension scheduling error
Extension debugging of shopmenu2 crash

BLOOD MAGE: balance needed. KDR low and WLR high
banish chance increased to 20%, duration reduced to 0.2 seconds
revival chance reduced to 50% maximum at spawn. minimum of 2% per level (from 2.5%)

NEW ENGINE: race restrictions
currently checks for minlevel, admin requirements. 
Functionality is basically from changerace but now exposed to allow database handler also check for race restricitons (on join)

fixed EXT not loaded spamming (you should still load it anyway)

Human teleport will abort of initial aim end point is < 150 units. Prevents lame short teleports...
Fixed minor startup error from shopmenu

ITEM2: snake bracelet 5% evasion
ITEM2: fortified bracers +10 HP
FIX: Major error in item2 registration

INTERFACE UPDATED TO SM 1.3.8
Recursive includes eliminated(SM compiler has changed). 



B1
nerfed naix. updated english translations for naix.
statistics transmits war3revision and stats version for better filtering.
scout no longer hidden, now the 18th race
-------------
Dark Elf packaged with some changes: 
Tribunal speed up amount and health decay amount. 
Tribunal no cooldown and is +ability toggle. Color animation fix and consideration for spies.
-------------
Dragon born packaged with some changes: 
static range for roar, level increases duration
scales only give physical armor
Dragonborn is 15% chance of immunity of ward/slow/skill/ult
ULT: breath: 5 second jarate for both teams.
-------------
Reduced Carrion Beetles damage to 10
Improved HP regen/decay engine, now instantaneously responsive to new regen decay values. It does use a little more cpu.

Error messages for extension failure

Forward for checking load conditions and silent failure. Return false to silently fail.
Example: this plugin should only load when game is TF
public LoadCheck(){
	return GameTF();
}

native name change
W3Denyable is now !W3Denied

fixed human health buff on tf2 and css

1.2.2


B9

fixed some dependencies and native errors
fixed error when awarding xp without race
1 diamond is given per second for each player on a team
XPGold engine now split for separate mods
W3GetKillXP accepts client again
W3GiveXPGold no longer accepts race and will automatically uses current race
reduced shadow hunter ult duration by 0.33
some effects are by apparrent team on tf2 (spy)
some effects wont display if player is invis (tf)
fixed race list when a race has "hidden" flag
weapon firing rate modification on disarm
"Cannot invis, being revealed" will be printed if the player is denied invis when the player would normally be (partially) invis

changes to intro menu
war3_introclanname cvar for customizing the intro menu, ie: Welcome to "war3_introclanname" war3source server!
war3_clanurl cvar for customizing the intro menu
Translators: please change the translations for intromenu

test race: SCOUT

B8

war3_hint_enabled removed

tweaks in chancerace menu handling

fHPDecay buff for continuous loss of HP, no proper kill credits yet
Sacred Warrrior now uses fHPRegen buff and fHPDecay
Soul reaper now uses Aura tracking and fHPDecay

SMBatchCompile.exe updated, using compile.exe to compile. .sp files are randomly spread across 4 compile threads

buffs for speed gravity and glow are calculated in a seprate engine

moved claw damage to posthurt
optimized shopitems 1 

succubs assault tackle cooldown is now 10 (why it was at 3 idk)

fixed damage recieved displayed in improper language

optimized aura engine

cvar war3_max_shopitems and war3_max_shopitems2 for limits on how many items a person can have for each shopmenu

suiciding on spy is not allowed

W3Denyable(event id, client) and W3Deny() is a 
simple system of messaging where one plugin initiates a W3Denyable call and another addon would hook and call W3Deny() to block.
this allows main engine to expose control paths to addons.
this is just an easier event than War3Event but offers less flexibility.
for an example, see undead and addon_nospysuicide

banish reduced to 0.4 duration and no longer changes the victim's aim

B7

Glider 010711:
	* New function in the Interface: bool:War3_IsL4DZombieEntity(iEntity)
		* Shortcut for War3_IsCommonInfected(iEntity) || War3_IsWitch(iEntity)
        * Also returns false if the game engine is not l4d!
		
	* Damage System engine:
		* Check if a player is valid before checking if we should check immunitys
		* Replaced some checks with War3_IsL4DZombieEntity

TF2 Speed buff system fixed. It did not set speed to zero when intended, so we now set speed to 1.0000


B6


Glider 300611:
	* Added new stock War3_PrecacheParticle(String:particlename[]) to precache particles
		* Please note that this will not add the Particle to the download table automatically!
	* Precache the achieved particle in the level up particle addon for games that use iT
		
	* EXPERIMENTAL L4D2 SUPPORT! (I have not tested L4D1 and don't plan to anytime soon)
		* TAKE EVERYTHING IN HERE WITH A GRAIN OF SALT!
		* SOME OF THE THINGS ARE STILL BUGGY/NOT FULLY IMPLEMENTED YET!
		* PLEASE REFER TO THE FORUMS FOR MORE INFORMATION!
	
	+ Engine/Addon Changes
	* Added UI/hint.wav to the files that are supposed to be precached since it wasn't on L4D2
	* Made LevelUpParticle work for L4D2
	* Prevented sounds from being added to the downloads table on a l4d/2 server
	* Changed the damage engine to properly handle common infected and witches
	* Changed the changerace code to allow race changing while standing in a saferoom on l4d/2
		* Added an addon that allows race changing for the first few minutes on maps that don't have
		  a saferoom
  	* Allow race change in a survival game that has not started yet
  	* Added special/common/uncommon infected aswell as the witch to the xp engine so you get credit for killing/surviving
  		* Lots of cvars to tweak these values for your server! Look out for war3_l4d
  		* Some of these don't seem to work properly yet (defib...)
	* When somebody calls "resetskills" their skills will be reset next time they enter a saferoom
		* If you are already in a saferoom you need to go out and back in currently
  		
	+ Include changes
	* Don't load any offsets when the engine is l4d/2
	* Added some new constants for W3XPAwardedBy. I'm not too fond of them, so they might disappear or be changed soon
	* W3IsDamageFromMelee returns correctly for l4d2
	* Added lots of new stuff to the War3Source_Interface
		* bool:War3_IsL4DEngine()
			* shortcut for checking if the engine is l4d or l4d2
		* bool:War3_IsCommonInfected(iEntity)
			* Check if iEntity is a zombie entity (common or uncommon)
		* bool:War3_IsUncommonInfected(iEntity)
			* Check if iEntity has a uncommon zombie model
		* bool:War3_IsWitch(iEntity)
			* Check if iEntity is a witch
		* GetSurvivorTempHealth(client)
			* Get the amount of temporary health (pills/adrenaline...) a client has
		* SetSurvivorTempHealth(client, hp)
			* Set the value of the temporary health (pills/adrenaline) of client to hp
		* GetMaxMagSize(const String:weapon[])
			* Returns the max amount of ammo a mag can hold for the given gun. I have only added the values for l4d, so please port this for tf2/css/dod:s
		* GetMaxBackupAmmo(const String:weapon[])
			* Returns the max amount of ammo a gun can hold as backup. I have only added the values for l4d, so please port this for tf2/css/dod:s



war3_hint_enabled 0/1 cvar for hint engine, why would you ever turn it off though? you can still see the votes.
EXT: fixed possible startup hang on linux

crypt and naix now have chance modifiers implemented on posthurt
fixed other chance modifiers

only allow 1 death message that is forwarded per frame per victim maximum to prevent double xp kills

TF ONLY: chance modifier change, chance is now based on time since last bullet hit. 
linearly reduced as last hit time goes from 1.0 seconds ago to 0.0 seconds ago.
(if last hit was X seconds ago, chance is reduced to X percent chance on top of the original chance when implemented correctly)
W3ChanceModifier returns 1.0 if last damage was longer than 1.0 seconds.
Chance modifier time interval is only triggered on "bullet" damage

TF ONLY: claw damage is now PER SECOND (default to 15) equivalent 
except first shot (first shot deals 50% of that damage),  
that means low rate of fire weapons like rocket launcher won't always reach 15 damage per second. 
this algorithm may be changed later

fixed naix leeching off self damage
naix feast prints hp gained to console
fixed incorrect semaphore behavior on linux, causing servers to hang after 20 seconds

B5

fixed rewarding extra xp for melee kills
some xp reward cvars have changed by default
added giving XP for touching hostages and losing xp for killing one

additional translations: (please translate the following 5 phrases, notice these are "lost" not "gained" )
You have lost {amount} XP and {amount} gold for {award}"
You have lost {amount} XP for {award}"
You have lost {amount} gold for {award}"
"killing a hostage"
"touching a hostage"

touching hostage gains same amount as rescue
killing hostage loses twice as much as rescue

fixed translation not found error for sh._common
system check is now case insensitive

extension:
now correctly updates server info to master server
feature: automatic gamedata updates


B4

level up print prints the race (please translate, its in War3Source_Addon_LevelUpParticle)
discovered a sourcemod bug, replacestring not respecting max length and overwriting other people's memory, resulted in infinite loop. 
buffer sizes have increased to counter this problem for now, this may also fix stack errors
Thanks to Dragonfly for allowing Ownz to diagnose the problem on his server.
BUG id: https://bugs.alliedmods.net/show_bug.cgi?id=4943

FIXED orc chain lighning cooldown

B3

marked natives as optional, for debugging purposes
removed DLL visual studio redistrubutable dependency
fixed and improved hint engine and cooldown engine to work with tf2 correctly

B2

database not connected warning in race/hero menu
print plugin name when damage engine errors one a few specific errors
sdkhooks.inc and sockets.inc how packaged inside w3incs, those will be used by the .sp files

fixed cooldownmgr handle leak

B1

Extensions are now used, update the extensions folder!!
Report as bug if they do not load or have errors!
I can help you setup, PM ownz

skillcount now ignores zero, aka skillnum of zero is invalid, if your race uses hard coded numbers, they will have errors
loop from 1 to <= race_skillcount
skillid of 0 is now invalid
MAXSKILLCOUNT increased to 8 to accomodate 7 skills

levels should not be lost, however:
you SHOULD BACKUP YOUR DATABASE
last skill will lose levels due to shift in skill level storage:
[4 4 4 4] -> [4 4 4 0] but still level 16


HINT engine, one plugin to manage all hint messages
attaches other messages to itself for compatability

Object engine:
for flexible data management, psudo object oriented approach, can be used as arraylists


1.2.1

(there is no final for this version as we continually add new features)



B8

fixed ring regen leak

limit outstanding socket 2 connections to 200
player class property: LastChangeTeamTime to remember when the player last changed team
removing a player from a limited race is now by LastChangeTeamTime
Damage Engine improved

Checks for when dealdamage and damageModPercent can be called for consistency
damagemodpercent can only be called in:
forward OnW3TakeDmgAllPre(victim,attacker,Float:damage);  
forward OnW3TakeDmgBulletPre(victim,attacker,Float:damage);  
dealdamage can NOT be called on the above.
native W3GetDamageStack(); to get the stack depth

Races modified to fit the damage system
ORC prints correct damage
return damage based on post hurt, real damage values

stock W3PrintSkillDmgConsole(victim=0,attacker,damage,skillnum){
stock W3PrintSkillDmgHint(victim=0,attacker,damage,SKILLNUM){
now takes the skill num in the last argument instead of the skill name, automatically gets the correct translation

stats engine sockets 1 merged with sockets 2. Queues requests on error / timeout

B7

fixed OnRaceChanged and OnRaceSelected
fixed ^ again... thanks to Invalid

B6

database connection separated into own engine, game mode specific engines handle the rest
war3_show_sockets_error cvar created, default 0, prevents socket error spam

possible savexp fix: 
on disconnect: save xp, reset all player variables, then subsequently retriggerd a save on a zeroed out race. 
Valve must have alterned the order, where OnPlayerDisconnect, these functions returned true after the update.

renamed many engines

B5

recompiled after april 14 update
INTERFACE CHANGE, moved AskPluginLoad2Custom to interface, required for early operations. (only affects those that register natives and forwards)
Fixed shadow hunter aura leak
deprecation: OnRaceChanged will change to OnRaceChanged(client,oldrace,newrace) for easier race management
SH: added minlevel
SH: some native renaming for SH/W3 ie W3GetReqXP -> SHGetReqXP as these are in different engines
war3 cvarid = 0 is no longer used, can help catch some errors
graceful unload via AskPluginLoad2
faster initial system failure  check to prevent spam

B4

INTERFACE CHANGE, FULL RECOMPILE OF CUSTOM PLUGINS REQUIRED

shopmenu2 translated, thanks to schmarotzer
major documentation changes

changed how game mode is determined to work with linux. Thanks to CGA for proving a linux server

b3

hp REGENERATION ENGINE
Aura tracking engine
shadow hunter and shop items now use HP regen engine
shadow hunter now uses aura tracking
human teleport range reduced to 1000 from 1200 max
shadow hunter now has a static heal distance of 500

B2

INTERFACE CHANGE, FULL RECOMPILE OF CUSTOM PLUGINS REQUIRED

SH_ files no longer required for war3
War3Source_SH_Mode renamed to War3Source_SH_Mode_Select, this file is always required!
Many additional features
shopmenu2 currency = diamonds
no diamonds are currently given, however all shopmenu2 items are free currently
diamonds are saved like xp, database will automatically change
three items are available, boots has effect, the other 2 doesnt do anything right now

batgirl added - ported from old SH Source

B1 date: 3/21/2011

SUPERHERO SOURCE INTEGRATION, ALL PLUGINS ARE REQUIRED

INTERFACE CHANGE, FULL RECOMPILE OF CUSTOM PLUGINS REQUIRED

fixed war3_orc_nocritgloves 	
invis weapon attatchments on css players (not working, test code is there) 	
1fixed setlevel as custom 6 flag (t) to rcom 	
playerinfo was displaying own armor
ShowXP was not always displaying correct translation
showskills -> myinfo (in helpmenu)
removed deprecated functions
dont show menu when buying item via say, and could not afford item
Hammerstorm tranlated
check restricted items on SetRace
level 7 gains less xp fix
removed empty functions
increased stack size, maybe it would prevent errors?


1.2.0


B7

NEW RACE: HAMMERSTORM (please translate)

added Levelbank info in detailed information (war3admin)
added Levelbank Managing in war3admin
A little for loop optimisations
resource precache stocks from Frezzy
disabled SH heal wave beam for now
Added bImmunityWards buff (skill immunity will include ward immunity)
socket errors now will print to NotError log
Added AntiWards item
fixed xp retrieve time count


B6
event InitPlayerVariables
fixed some race restrictions
renamed 2 translation files (for each language) because TC admin likes to block them

B5

debuging stuff

w3log w3logerror w3lognoterror (new) are now in separate files

constants change
100 maxitems
200 maxraces

B4

optimizations, error checking
error in string comparisons dude to length difference, this fixes duplicate skills

B3
 
SH healing wave effect for TF2
B2

minor menu fixes

B1

translation updates
color messages changes
color.inc is now included


1.1.9   1/5/11


Final

race flags: 'nobots' will disable bots from aquiring that race automatically. if ur using an addon that manipulates bots races, it is their job to implement this
fixed array out of index in race class
some colors to print outs (translations)
fixed orc nade never activating


B9


W3Event   OnDeathPre, //EventArg1 = attacker.  before w3 actual death forward is called to do some reading ( ie before items are lost)
items hidden flag now effective
war3_set_race_on_join is now default 1
say myinfo = playerinfo on yourself

B8

set race on join no longer shows change race if race is set
removed decl from sockets2
ring item heal particle

B7

minor memory leak, may not directly relate to "stack memory leak"
edited possibly unterminated strings

B6

UPDATE ur translations
Race Skill replacement values, see human race and human translation file.

B5

XP curve increased
maxraces increased to 100
maxitems increased to 40
removed 3 exposed commands

B4

update translations
Fix inverted win stats
other minor changes
race on join is now set after xp is retrieved
races, item, war3 config stats
multi buy tome, ie "say tome5"  "say tomes5"

B3


Merry Christmas
Gift to you:
Huskar - Sacred Warrior modified and packaged (beta, play it for balance stats)

sockets 2 uses POST data (serverinfo)
new event: CanBuyItem, //client, arg1=itemid, if eventarg2 is non zero, he can buy// you have to do the message on the reason why he can't buy
translation updates
new native W3GiveXPGold(client,race,xpamount=0,goldamount=0,String:awardstringreason[]);
nerfed lich_o / LICH, dark ritual heal amount reduced
chance modifier added to naix
nerfed naix overleech limit
simplified some races, removed redundant and replaced with proper "no ult" prints and "no target found"


B2

bSlowImmunity buff. stun and bash still stops you
[test] escaping ' in hostnames
admin console looping limits fixed, thanks to Namolem
GetItemIdByShortname fixed
set race on join works with restrictions now. will not work perfectly
no stats collection when cssdm is loaded

B1
UPDATE UR TRANSLATIONS

lich frost armor reduced to max of 4 points
night elf entangle reduced to max of 2 seconds.
night elf translations updated
spendskills now translates to client language properly
race names into statistics should only be english
races on your team and other team moved to raceinfo (changerace was too crowded)
metric numbers in "no target found", requires recompile of your custom races and using the stock in the interface.
set war3_metric_system 1 to use metric





1.1.8

B9 = STABLE / FINAL
event added
OnPostGiveXPGold fired right after OnPreGiveXPGold (xp and gold have been already given), with same variables:
W3GetVar(
EventArg1 -- awardedfromevent
EventArg2 -- xp
EventArg3 -- gold

B8

CSS level up particle

B7

new natives
native W3GetItemOrder(itemid);
native W3ItemHasFlag(itemid,String:flagsearch[]);
native W3GetItemCatagory(itemid,String:retcatagorystr[],maxlen);
*catagories have not been implemented yet, these natives will aid in making a catagorized shopmenu if one wants to
of the above, each is an war3 internal cvar, per item

fixed necklace buff not removed on item lost


B6
translation updates

B5
succubus jump cooldown
succubus jump tweaks
chronos time leap tweaks, works with tf2 now
Hex and Silence checks added to succubus and chronos

B4
changes and debug messages for race restrictions


B3

helm miss text

is weapon melee update

B2

translations update

B1

interface change, requires recompile of all custom races

buff system addition:
bInvisWeaponOverride, //set true to use override amount
iInvisWeaponOverrideAmount, ///0- 255
only one race shall use weapon invis override

statistics now only relies on sockets

reduced big bad voodoo to max 2 seconds


1.1.7

Final, B9 

separated buff sum, absolute, separated float and int

fixed physical and magic armor

Lich packaged, (edited), differnet shortname (lich_o)

particle effects for shadow hunter, soul reaper, orc, blood hunter

translations changes

restricted items are now checked right before OnWar3EventSpawn

statistics now uses mostly sockets so it interferes less with XP database queries
PLEASE INSTALL SOCKETS IN THE addons/sourcemod/extensions  

increased maxraces and maxitems

fixed night elf evading and dealing thorns damage

fixed cooldown ready when u dont have skill for race with spawn cooldown
translated cooldown

Mask no longer grants health when dealing damage to self (thanks to Glider)

resetskills will queue for next death (Glider)

B8

sort by minlevel cvar has been removed

race order is now defined by each race's cvar, set "war3 cvarlist <raceshortname>_raceorder <INTEGER>", you may set it equivalent to your minlevel*100 to order it like that
by default each race increments by 100 , undead = 100, human = 200  (original race register order)

race has a flag cvar "war3 <raceshortname>_flags hidden" will hide the race

sorting improvements

fixed admin menu giving item to self instead of target

changed night elf entangle duration to be level based, distance is now constant, some cvars removed


more translation support on the core side. update ur translations.
item translations

event PlayerLeveledUp

bDoNotInvisWeapon buff, true to not set invis on weapon. remember to unset

B7

fixed orc no weapons bug

added "spec player" to playerinfo

native W3Log and W3LogError logs to seprate file and is emptied every startup

fixed negative xp and gold printing when no actual xp or gold was changed

statistics additions

B6

xp for kills have a death filter. victim must be dead to give xp

internal cvars no longer uses "setcvar" remove em!
IE: war3 undead_minlevel 0

changed some internal workings of cvar system

doubled corrupted disciple's ult zaps per minute for TF2, adjusted damage

fixed hanging weapon restrictions

added some cvar descriptions

orc semi translated

bloodmage fixed revival when alive



B5



added item cvars!!!

per race and item cvars moved to an internal cvar system
type

war3

in console to get started:

war3 <arg> ...  Available commands:
    cvarlist <optional prefix filter>
    <variable> <value>

equivalent change:

war3_human_minlevel 10
IS NOW:
war3 human_minlevel 10

how do i convert my current configuration??

SAVE A COPY OF YOUR CURRENT CONFIGS


enter "war3 cvarlist <optional prefix filter>" to see which cvars are now internal\
minlevel, restricted items, team limit have been moved
carefully replace "war3_" -> to -> "war3 "  (include that space at the end of)
I WILL WARN YOU AGAIN, THIS IS FOR PER RACE VARIABLES ONLY (minlevel, restricted items, team limit)


changed some default item prices

fixed bomb plant/defuse xp giving


B4

no xp gain when there is less than minimum amount of players playing (on team)
war3_min_players_xp_gain 2
bots count as players

bots now have a random race with full levels (may be glitchy on whacky races)

war3 min version checking

Added more weapon filters for chronos

fixed not allowing to buy tomes when at max items

OnPreGiveXPGold event added. arguments are 1:why xp was awarded (see enum  W3XPAwardedBy), 2:how much credits is to be rewarded, 3:how much gold is to be awarded.
EventArg1,
EventArg2,
EventArg3, respectively
changing these EventArgs respectively will change the gold and xp given

B3

shortened "Required Level" to ReqLvl on changerace menu because the menu can be cut off

more stats changes and fixes



B2

possible fix for levelbank leak

some stats changes

B1

Chronos packaged

cvar to prevent statistics error spam (default enabled)

some additional statistics collection

fixed war3_addlevelbank erroring which locked database forever

fixed invalid ent when trying to set weapon alpha

fixed cooldown going into negatives and never expire

fixed cooldown manager not showing skill names in some cases

fixed resetting cooldowns on map start (affected crypt)

reduced crypt lord ult to max 40% hp, and 800 range (OMG NERF SOME MOAR? yes)

fixed weapon not going invis (the ones that can go invis)

added bNoClipMode, to buff system

isolated playerinfo, raceinfo, shopmenu, item class, item ownership

fixed playerinfo race leak, allows race 0 name retrieval ("No Race")

---^^-1.1.7-^^--------





1.1.6 Final

fixed bloodmage revival cooldown (may not be revived via pheonix again in 15 seconds)

on spawn ultimate cooldown for human and orc for 10 seconds

prevented some statistics spam from database errors

B8

added error messages to in game changerace menu (since u people <he who shalt not be named> never look at the error logs)

updated statistics engine

fixed skills duplicating with translated skills (undead)

fixed setgold command

B7

succubus changes, now a packaged race

reduced night elf true shot to 20%

reduced crypt lord impale chance to 15%

help menu has its own engine

W3CreateEvent has its own engine

changed undead proc chance and leech amount

full race translation prototype (on undead, see undead for example)

blood hunter ultimate damage/distance increased

XP recieved for being near bomb plant or defuse

XP handling moved to its own engine, new xp API

W3CreateEvent reimplemented

W3LOS will trace toward abs origin (feet) instead of eye, because it will never hit smaller models ie headcrab / ducking



B6


Weapon drop signature updated

optimized orc timer

races are stored in its own engine

fixed war3bug not storing foreign characters correctly.

cooldown manager overhaul (no API change), now implemented via Linked list, estimated to be 8400% more efficient

weapon restrictions will check for current weapons next frame when set

statistics for races kill deaths and time played

Fixed warden and orc respawn exploit (queuing these races as ur next pending races and getting respawn skills when u die)

W3GetVar to access some temporary/persistant variables from war3source, without creating natives for each of them. see API

W3SkillCooldownOnSpawn makes a skill go into cooldown at player spawn. see API

no longer prints precached sounds to server console

engines named

B5


fixed undead leeching while dead

new native W3LOS(client,target) checks line of sight

damage engine improvements, correctly remembers damage even if the dealdamage kills the player (needs testing)

orc will calculate critical damage correctly

orc nade will deal true damage, because the initial triggering damage already went through armor

orc nade damage reduced to max of 2.2x and minimum of 0.7x

fully implemented physical and magic armor. physical and magic armor is ignored TRUE damage (duh)

weapon restriction priority to override others (advanced developers)

changed procing skills to Hexed check

remade skillsinfo menu

reduced human bash to 0.2 seconds

fixed boots buff still applied when it was removed (traded)

B4dev1

War3_GetAimTraceMaxLen(client,endpos[3],distance);
traces towards where the client is looking at but ends at a certain distance



B4

ALL CUSTOM RACES REQUIRES A RECOMPILE

update the addons folder!

changed Credits -> Gold !!!! along with the commands
IF YOU ARE ON SQLITE, YOU WILL LOSE YOUR GOLD (OLD CREDITS) . MYSQL will not lose credits->gold.
SQLITE cannot rename column and its not worth doing full db conversion for sqlite.

removed command showgold, whats the point? just open the damn shopmenu

optimized buff system, now fully cached!

all default and packaged races now implement silence checks

added translation system to main war3 and undead and human (work in progress). No actual translations are available

_common translation (stuff like "Ultimate Not Ready") is automatically loaded for all races

damage multiplier is now nested outside dealdamage, so the dealdamage inside a takedmg does not change the original damage multi.

delayed restricted items removeal (health was giving problems)

changed weapon restrictions to have per client per race restrictions

glow alpha is now ignored (deprecated)

B3

engine 5 (buff system) optimization (cache values on change)

fixed shopmenu trying to retrieve CS money on TF2

war3bug has a 1 second delay between reports (per player)

war3bug can also forward the bugs to your own configured db (same db where ur xp is saved ie "default" in database.cfg)
set "war3_bug_to_my_db 1" in server.cfg or war3source.cfg

fixed engine 8 escape string

orc revive changed to OnWar3EventDeath to prevent race switch revival


B2
report a bug in game: say war3bug <bug description>

cvar change game description
war3_game_desc 1 (default 1)

war3_buyitems_csmoney is now default 0

fixed voodoo

fixed sock staying after trading it for a different item when item limit was reached

fixed health item staying after it was replaced, it will force you back to new max hp if you are higher

fixed shopmenu item buy replacement 

no target found message was not divided by 10

glow buff constants and if same priority the latest set takes effect

B1

interface overhaul, old races will work with new interface however they are easily convertable, use the new interface functions
see interface for new functions


old functions are DEPRECATED and WILL NOT WORK, follow the deprecation and implement the new functions


overhaul of buff system into engine 5

glow is now buff system

overhaul of damage system (engine 6)

self check system (engine 7): if any core plugins fail, all war3 related plugins (other core and races) will automatically shutdown to prevent error logs spam.

compiled interface compatability check implemented for future races

added more tags for more compile time error checking

update notifier and a server tracker (engine 8)

undead optimizations

buy items via cs money

war3_buyitems_csmoney 1

changed human trace to MASK_ALL

fixed multi human double teleport

reduced undead low gravity to 50% of normal gravity at max level

administrative commands and menus moved to engine 9 and 10

xp is shared across races when saving xp is disabled

1.1.5

final release




B9

public release

update your gamedata/plugin.war3source.txt   !!!

minor crypt lord changes to fix retriggering issues

fixed being able to buy with say when item is restricted

Engine 4 deals with weapons (especially restrictions)
native War3_WeaponRestrictTo(client,String:onlyallowedweaponsnames[]);
ie "weapon_knife,weapon_hegrenade" //c4 automatically allowed 

separated some include files

war3_print_levelbank_spawn 1 (default 0)
to print player's levelbank every spawn if they have any

default auto save time reduced to 60
auto save will no longer print to chat by default ( war3_print_on_autosave 0 )

dev1

merge sort algorithm for sorting your races by min level! maintains relative order!
war3_sort_minlevel 0

buff bFlyModeDeny

armor buffs fPhysArmor, fMagicArmor are now used in DealDamage (maybe also in normal game damage later)
both scales according to http://honwiki.net/wiki/Armor

stock print skill message  and damage functions (see interface)

cvar for bonus xp for level difference (war3_xp_level_difference_bonus)*(level difference) if victim's level is higher

removed OnRaceChanged
please change it to OnRaceChanged

revivals (mage, orc) allows guns to have full ammo



B8FIX 1
reverted war3_dealdamage back to creating an entity each time



B8

crypt lord spiked carapace will deal damage to its attacker, and other minor changes with spiked carapace

races can be reloaded on the fly, use: sm plugins list, sm plugins reload #, and server command "loadraces" to reload a race.

force redefinition of MAXPLAYERS

changed all 65 and 66 arrays to use MAXPLAYERS

increase human teleport check time

race limits per team:
war3_racelimit_enable 1 (default 1)
war3_SHORTNAME_team1_limit X (default 99)
war3_SHORTNAME_team2_limit X (default 99)

auto join race will be disabled when race limits are enabled 

races set by admins do not count towards race restrictions

B7

new buffs
bSilenced,//cannot use skills
bStunned, //cannot shoot, cannot cast, cannot move
bBashed, //cannot move
bDisarm,//cannot shoot
bNoMoveMode,//move type none! overrrides all other movestypes
bFlyMode, //fly mode!

War3_ValidPlayer is now a stock instead of a native

point_hurt entity is not recreated for War3_DealDamage, other optimizations

team name and level in players with this race list

Engine 2 for tracing view end point (untested)

B6

skills limit increased to 7

playerinfo shows race on the name

No Race name for race id 0

added naix sounds

naix teleport location will be cached death location of the victim (which does not equal the abs origin right after he died)


naix will  telepeort to victim location only if he is ducking

added mask of death sound, implements War3_TrackDelay for not alowing sound to be re emiited under a .3 second delay

mask of death now calculates correct leech amount via PostHurt instead of theoretical TakeDamage


B5 
increased default XP rewarded for objectives (cvars)

added level bank for new players, cvar for level bank default is 30. DB failure will not trigger free levelbank

show levelbank amount  in changerace menu if he has any

more info added to playerinfo and skillsinfo like max level and skill level

playerinfo can direct people to a menu about his current race

raceinfo can direct people to a menu about all people who are currently that race

fixed a naix print message

tweaks to the CD electric tide animation

forcing save xp on race set

B4 Dev

added native War3_GetRaceIDByShortname(String:raceshortname[]);

B4

cvar war3_SHORTRACENAME_restrict_items "claw,orb"   to prevent people from buying the listed items if they are that race
restricted items for race is checked on spawn, and will be removed without refund


removed many "public " keywords for performance (minor)

buy via say or team say command using item shortname. extra characters after the shortname are accepted "boot" "boots" "bootwtf"

reverted race change to at death. race will be changed at spawn or death (after OnWar3EventDeath so u can do some last minute stuff right here before his race changes)

TRUE/MAGIC damage via War3_DealDamage in CS will remove CS armor and reapply CS armor, PHYSICAL will have to go through armor
War3_DealDamage will use HP comparison for getting the damage dealt if victim is still alive after damage, otherwise war3 physical and magic armor reduced damge is considered the damage dealt

increased CS undead suicide bomber max damage by 66 at every level (166 - 266 theoretical max dmg, reduced via CS armor)
For enemies with Full HP full armor you basically have to be touching for instant kill, the armor basically reduce half the damage. 
suicide bomber damage count as PHYSICAL

welcome menu changes

B3

fixed cooldown manager not managing the last race for spawn and death expirations

better handling of level check

increased CD overload range
added CD overload zap sound

fixed CD not tracing correctly in CS
CD ultimate overload will double the zaps per second in CS for the same duration

fixed weapon fire event preventing tf2 load

moved cooldown manager and created delay tracker into its own plugin (engine 1)

added sound for CD ult state

fixed cd ult not damageing the lowest hp target

War3_DealDamage now REQUIRES a weapon name, this is likely to break backwards compatability on compile, but those that are already compiled will work fine

fixed Naix feast doesnt work if its maxed

simplier constants for game (CS,TF,DOD)

B2

DATABASE CONVERSION
(use DB converter once and once only)
all xp are stored in one table, and one main table for other player data
xp is saved for one race only (1 query), and if you change race ur old race xp will be saved

sql separation for saveing and retrieving parts

set race on join is now default 0

fixed Sr ultimate cvar

fixed weapon fire event for attack speed (CS)

playerinfo can accept name argument

levelbank adding fix

war3sourceraces insert will be threaded

native War3_GetRacesLoaded
native War3_GetRaceName
native War3_GetRaceShortname

xp retrieval and saving will be significantly faster

set race will automatically print u are now that race

misc print messages

B1

fixed shopmenu scroll exploit

playerinfo shows xp

fixed night elf print evasion

night elf respects skill immunity

War3_DealDamage overhaul, see API. old races will get error, must recompile with new version
War3_GetWar3DamageDealt to get the actual damage dealt after armor (armor to be implemented)

damage print for chain lighning

soul reaper respects Skill immunity

fixed attack speed modifier

playerinfo has total levels info for player

fix- playerinfo was displaying your own levels for skills

naix lifestealer race included

more constants:
enum War3Immunity
{
	Immunity_None = 0, //generic zero
	Immunity_Ultimates, // Immune from ultimates
	Immunity_PhysicalDamage, // Immune from health taking
	Immunity_MagicDamage, // Immune from magic based stuff (doesnt not include ultimates)
	Immunity_Items, // Immune from shop items
	Immunity_Skills, // Immune from all skills
};

enum War3DamageOrigin
{ //where damage is from   skill or ultimate etc
	W3DMGORIGIN_UNDEFINED=0,
	W3DMGORIGIN_SKILL,
	W3DMGORIGIN_ULTIMATE,
	W3DMGORIGIN_ITEM,
}
enum War3DamageType
{//damage types
	 W3DMGTYPE_TRUEDMG=0,       //normal damage without accout for physical or magic armor
	 W3DMGTYPE_PHYSICAL,
	 W3DMGTYPE_MAGIC,
}


1.1.4

Final

raceinfo

playerinfo !!!

changed skillsinfo to show all skills on one page

warden shadow strike will be removed on victim spawn

B9


sound for soul reaper judgement ability
reduced judgement cooldown to 10

locust range print

it is now safe to call War3_GetGame in PluginStart because Game is now detected earlier

more fixes for warden, event was registered per map so it stacked per map

B8

randomized mole locations

added misc stocks to War3Source_Interface to help with your coding

more fixes to warden, better print messages

for u naggers out ther: war3_mage_revive_delay 2.0


fixed blood hunter DOT causing health =0 glitch in CS

B7

MAXRACES changed to 30

levelbank wasnt retrieved on join (forgot to change column string in retrieve and save), causing other data not to be retrieved or saved

xp retrieval time print

B6

war3_setlevelbank -> changed to war3_addlevelbank

war3_orc_nocritgloves 1 //disable orc nade crits if he has gloves

enlarged levelbank storage size (was tinyint therefore limited to +127)

change all tinyint to int

B5

level bank:
say levelbank
also in war3menu
war3_setlevelbank "STEAM_BLAH BLAH FULL STRING" <amount>


shopitem limit 
war3_max_shopitems 3

buying an item when u already have 3 items will give u a menu to choose an item to replace, you will not get credits back

4th item can be bought if its instant use (tome)

native War3_SetItemProperty sets an item property

attack speed modifier
fAttackSpeed

gloves of warmth (nades) will disable orc crit nades

orc nade crits are non lethal 


changed xp leveling, leveling should be easier at lower levels and harder on higher levels

B4



mostly a CS update

scroll of respawning will respawn you when bought if you are dead

more checks for respawn and item recarnation (CS) so that if one triggers it does not trigger the other
extended scroll of respawn time so that default orc respawn activates first

moleing when your not alive (spec)

ankh alive check before using it (dont use this item if revived by other means like orc warden and blood mage)

blood mage revival grants weapons back (CS)


reduced warden ultimate vengence spawn HP

cvar war3_warden_vengence_max limits the max amount of revival times for ultimate (CS ONLY)

fixed vengence infinite respawn cycle (CS)

debug messages for vengence

other misc fixes for warden

revivals grant armor (CS)

B3

moved suicide bomber ring animation lower for css

blood hunter uses deals damage for damage > current hp else direct hp reduction

delayed war3source.cfg execution so that all races are loaded and cvars are created before changing cvars

OnWar3EventDeath will no longer forward on dead ringer death

B2


Blood hunter drained hp of teammates

blood hunter no longer slows via drain damage / ult (damage method changed)

native War3_DecreaseHP(client,amount) directly reduces health

B1

added war3_item_restrict "" ie "claw,orb" to disable items on the shopmenu

shadow hunter wards no longer trigger items/ abilities, damage increased from 2 to 3, time between each strike increased

converted shopmenu items array to shopmenuclass.inc

skill immunity and ultimates immunity now converted to the buff system

item shortname will be listed in itemsinfo

modified shopmenu item registration API

1.1.3

BLOOD HUNTER RACE!!!
with sound and gore (gore is tf2 only currently)

1.1.2


fixed soul reaper ult will respect immunity


added a public cvar enabler test script

forward War3_GlobalEvent
native War3_CreateWar3Event

forward OnWar3EventPostHurt (generic)

removed a dummy cvar

added old CD sound back

fixed changemenu showing 1 race early, where the last race wasnt retrieved yet

optimized undead a little, using new forwards

more valid client checking in sql returns


public OnWar3LoadRaceOrItemOrdered(num) will be reserved for default races
public OnWar3LoadRaceOrItemOrdered2(num) for correct load order for CUSTOM RACES!

B1

added events OnWar3EventSpawn, OnWar3EventDeath
converted races to use these events

fixed error log spam if war3source main is paused from soul reaper

MAJOR CONVERSION: new race registering interface, allows different skill number and levels
race with max level over 16 will level as if they are level 16
database change will not make you lose xp, but may be whacky for the first time you are choosing the race
SEE RACES FOR EXAMPLES
OLD RACES WILL NOT BE COMPATABLE!!! YOU MUST CONVERT THEM TO THE NEW SYSTEM

public OnWar3LoadRaceOrItemOrdered(num) for correct load order
public OnWar3PluginReady will be called after for non ordered races 

changed some forwards and natives

changed all races to the new race interface

war3_crypt_locust_range for you locust winers, default 99999!

removed all ultimate per life limit cvars 

implemented skill level limit, cannot level skill to 1/2/3/4 without total level being 1/3/5/7
ultimates leveling are limited at (min ultimate level)/+2/+4/+6

implemented disabled menu options to signify it is disabled and cannot be selected

orc human invis is now minimum of 40 from 35

small delay for suicide bomber so the kill order is correct

fixed some war3_ commands not working because GetClientRace was not on the target but the issuer

lowered default minimum ultimate level

fixed 1 possible instant level 16

1.1.1


final

removed debug for sql insert new players

B8

reduced human invis and cloak for CS

fix human invis and hp not activating on selection

fixed cloak and knife visibility reduction

condensed more SQL queries

B7

fixed bug where a person conduited right before map change will stay conduited forever

debug messages for db connect

changed how tables and columns are created. new players that are trying to create the entire table database are dropped by the server for excessive errors such as column already exists

reduced startup time by putting queries together

added damage names to war3_dealdamage uses

moved speed controls to on game frame

B6

fixed war3top<#>

no longer spams hint message when xp is still loading

race soul reaper included

B5

added new player xp creation debug messages

B4

added xp loss safe gaurd, xp will not save if level + xp is lower


B3 

fix blood mage round start loop limit

speed will set instantly on weapon change

reduced boots of speed and undead skill default speed increase to 1.2

reduced cost of boots and mask

clear all variables in connect and disconnect, players may be seeing xp of the previous player!!


B2
changed some item order

added itemsinfo to war3menu

fix orc ward healing




b1

new include (separated from playertracking): playerbuffs.inc

players data are now stored in static arrays! no more complicated handles, much more extensible
YOU DO NOT KNOW WHAT I HAD TO GO THROUGH TO DO THIS!!! ITS ALL FOR THE SAKE OF EXPANDABILITY!!!!!!

new system for buffs and debuffs!!! very expandable

unholy aura (speed) reduced to maximum increase of 30%

undead skill distract is back to unholy aura for TF2

human invisiblity to minimum of 35% visibility

orc invisiblity to minimum of 35% visibility

orc invisbility will be lost for a short duration if hurt



speed buff and speed slow now implemented, along with low gravity

enabled boots on TF2!!!!

enabled orb of frost for TF2!!! if you think they are running too fast, get some orb of frost!

added say /speed command to see your speed

War3_DealDamage has 6th parameter which sets if the damage dealt is allowed to trigger and proc other modifiers (claws damage shall not retrigger, wards damage can retrigger)

modified races to be compatable with new war3source main

SPEED FROM RACES AND SPEED FROM  BOOTS DOES NOT STACK! fastest one takes effect
SLOW STACKS
GRAVITY DOES NOT STACK! lowest one takes effect


1.1.0

b2:

updated to 1.3.3 sourcemod includes

removed LoadGameConfigFile from night elf, it is causing crashes on CSS, and is not required for TF2

removed VERSION_NUM and added AUTHORS constants




b1:


added variable "war3ready" to some races to prevent console epic spam if main war3source plugin failed/paused. 
this should be done on any automatic loops and OnGameFrame. this however does not prevent other errors from showing up because war3source main plugin fail/paused

buffed corrupted disciple's electric tide to 140 max damage at level 4
corrupted conduit how lasts 10 seconds, allowng more time for teh the victim to lose more damage per hit
new version of this race's sounds have been uploaded, old unused sounds have been removed

fixed ring regeneration loop
ring regeneration now happens every second, cvar war3_shop_ring_time is now removed
Regen rate is now default 2 for 2hp/s for CS, 4 hp/s for TF2
cvars: war3_shop_ring_hp_cs 2 and war3_shop_ring_hp_tf 4 respectively

added sound ability_refresh.mp3 for when an ability's cooldown expires
added sound ult_ready.wav for when an ultimate cooldown expires (original name is resurrecttarget.wav)


1.0.9b fix 2

remove single quotes from names so they dont interfere with query statement

1.0.9b fix1
renamed sql functions and rearranged them so its easier to debug

added many debug statements into sql operations

temportarly disables sql retries

1.0.9b

new natives for cooldown management, so races do not have to keep track themselves
for examples see Corrupted Disciple, which has a cooldown ability, skill, and ultimate


/**
 * cooldown manager
 * basically self explainatory parameters, creates a cooldown for a skill (term skill used here is generic for skill/ability/ultimate)
 * printMsgOnExpireByTime prints message to client (if alive and same race) when this skill expires by time (will not print when expired by spawn or death or force reset)
 * CooldownPrintMsgName[] is the name of the skill that will be printed: ie Voodoo is ready. You pass "Voodoo".  
 * If left empty, it will say "Ability" for skillnum 0-2 and "Ultimate"
 * This string will also be used in War3_PrintSkillIsNotReady and is the only way to set it. you should never call  War3_PrintSkillIsNotReady before calling this manager
 * If there is a skill that has cooldown but not counted as an ability, you should not have it print on expiration
 * 
 * when a cooldown expires (by time, by death, by spawn, by force reset), it will forward to OnCooldownExpired(....) forward, use if u need to
 * @noreturn
 */  
native War3_CooldownMGR(client,Float:cooldownTime,raceid,skillNum,bool:resetOnSpawn=true,bool:resetOnDeath=true,bool:printMsgOnExpireByTime=true,String:CooldownPrintMsgName[]="");  



/**
 * how much time is left on this particular cooldown?
 * returns an int (rounted up from the float)
 */  
native War3_CooldownRemaining(client,raceid,skillNum);  


/**
 * basically make this cooldown expire, expiring is not considered "by time"
 */  
native War3_CooldownReset(client,raceid,skillNum);  


/**
 * is this skill NOT in COOLDOWN? YOU NEED TO CHECK IF CLIENT HAS LEVELED THIS SKILL FIRST, THIS IS ONLY COOLDOWN RELATED
 * you would only do this if this skill has a cooldown and u called War3_CooldownMGR
 * printTextIfNotReady=true will print a not ready message
 */  
native bool:War3_SkillNotInCooldown(client,raceid,skillNum,bool:printTextIfNotReady=false);  


/**
 * prints Ability/Ultimate Is Not Ready or something
 * the String can replace "Ultimate", its copied from the creation of CooldownMGR
 */  
native War3_PrintSkillIsNotReady(client,raceid,skillNum);


implemented corrupted disciple with cooldown manager
implemented shadowhunter with cooldown manager
implemented human with cooldown manager
implemented orc with cooldown manager
implemented night elf with cooldown manager
implemented blood mage with cooldown manager
implemented warden with cooldown manager
implemented crypt lord with cooldown manager
(we left out undead for now)

1.0.8b

fixed g_Game accidentally set to Game_TF breaking war3source on css

replaced many g_Game instances with War3_GetGame to avoid accidental assignment

1.0.7b

changed xp retrieval to retrieve first then insert if no exists, instead of inserting if not exists then retrieve. (Thanks to binaryblade)

changed War3Source includes directory to W3SIncs, long folder name somehow contributed to compile errors

separated cooldown management to cooldown.inc

separated sql section to sql.inc

added printouts into console for xp retrival progress

1.0.6

few more handle leaks fixed

itemsinfo added

reordered war3help by order of importance

there will be a zeroth dummy item, like how there is a zeroth dummy race

changerace menu will now show up when xp is loaded


1.0.5

moved some initial queries on server start to threaded. this allows server to start faster.

print console if voodoo is being countered by immunity

fixed hShopReferences handle leak

fixed shopvector handle leak

fixed arrayPlayers handle leak

fixed almost all menus leak

fixed most other handle leaks

1.0.4

human hp buff fixed for tf2

human hp buff reduced to max of 45

added sound for teleport

added sound for locust swarm

added sound for shadow strike

added sound for vengence

changed War3_PrecacheSound to a stock (in war3source_interface)

double sound emit to increase volume (kludge)

1.0.3

unstuck function (imperfect)

improved human teleport

fixed immunity not blocking teleport. immunity is currently calculated as being within 300 units of an enemy teleport end position. this prevents teleproting near you, but does not prevent them from teleporting away

revived players will have a stuck check

1.0.2

CD corrupted conduit skill immunity check

corrupted conduit change, max corrupting 1 target (auto activated when no on cooldown) for 1/1/2/2 dmg, max heal from negative conduit of 4/6/8/10 hp
duration reduced to 5 seconds, 15 second cooldown


moved some CD messages to HintText and added a few more messages'

War3_HealToMaxHP and War3_HealToBuffHP will no longer make hp less because current hp is high than max

CD static discharge will buff hp

races files (plugins) can be changed and reloaded without reloading war3source (dev support only)

warden ult can now overheal (TF)

server command war3_recallloadraces loads races again, (for devs) used if you added unloaded a race and want to re-load it mid game

War3Source_InitiateShopVector moved to map start to be called each map change and to clear old items before reloading new items again

dead ringer death no longer activates a revival, (moved the not actually dead spy into the spawn)

1.0.1

lowered the ring height animation for suicide bomber

missed particle sent to all

night elf evasion calculation into SDkhooks and now can evade death shot

native War3_HealToMaxHP

native War3_HealToBuffHP (heals to 1.5x max hp in TF)

HasAccess -> HasRaceAccess function rename

no longer use messages.inc

new cooldown manager
native War3_CooldownMGR
native War3_CooldownRemaining
forward OnCooldownExpired

fixed admin race access restriction, race will show up for non-admins, but a message if non-admins try to pick it

new RACE!!

Corrupted Disciple (CD)
exact stats are not given as they are not settled

SKILL1: Electric Tide
Expanding Rings at his current location, 
dealing more damage the further the ring is from the origin

SKILL2: Corrupted Condiut
Each attack by corrupted disciple weakens the enemy, making the enemy's damage lower

SKILL3: Static Discharge
A chance to turn recieved damage into healing nearby teammates

ULTIMATE: Overload
CD overloads himself with electricity, jolting the lowest HP enemy around him, while gaining attack damage
	
added sounds for CD


1.0.0.9

flame strike blood mage ultimate has 10 for TF or 5 for CS damage/second for 2/4/8/10 seconds

enabled self natives (war3source can call it's own natives)

War3PrecacheSound -> War3_PrecacheSound function name change

native War3_IsUbered(client), automatic false if not tf2

tf2 hp decay cvar time tf_boost_drain_time is automatically set to 60 on map start

native War3_IsCloaked(client), automatic false if not tf2

war3_dealdamage now automatically checks for ubered

any immunity check will check for ubered

added a damage control system 

orc critical 30% to 130% more damage (130-230% total for that shot)

MISS! text when enemy night elf evades

MISS! text when shadow hunter is in invul

changed xp curve again, higher levels level too fast

sourcemod includes have changed!!!!! 

native War3_DamageModInt (unused)

native War3_DamageModPercent directly changes the damage that will be dealt

many messages moved to console or hint text

1.0.0.8

night elf skills trueshot and thorns are 100% activation, with different percent for damage per level, all values are rounded down (2hp damage will inflict 0 zero extra damage, 2*0.35 = 0.7 rounded down = 0)

adjusted sucide bomber damage for CS

undead leeches health without chance modifier, leeched hp is now rounded down (aka wont leech if damage 2 or less given percent max is 30%)

fixed shopmenu description ("to look at" --> "to buy")

fixed undead suicide bomber not exploding when first selecting the race (from no race) when alive, or getting any gravity or speed powers

entangle now defaults to does not drop the victim's weapons (war3_nightelf_entangle_drop 0)

new war3_nightelf_entangle_noshoot  cvar disallows shooting (defaults 0 allows shooting)

sound for revival, voodoo, wards, orc chain lightning, level up/ change race

you are already that race if you choose a race that you already are

">" on race menu for your current race

"<" on race menu for your next race

changerace now takes effect on spawn, not on death (helps remove glitches)

reduced alpha for all flash screens (to 3), and fixed fade in/out (FFADE OUT should really be FFADE IN)

some output are moved into the console (such as thorns, trueshot, leech... because they are now 100% activation)

1.0.0.7

increased suicide bomber radius and damage (TF)

added cvar war3_command_blocking default 0, 1 to block chat commands from showing up such as shopmenu after it has been processed

all ultimates have infinite uses by default cvar and default 20 second cooldown

added developer access to the war3 admin menu (developers will be able give xp ..etc, hardcoded steamid)

increased max credits to 1000 (cvar default)

decreased xp per kill (high levels level way too fast)

shopmenu command in console

shopmenu now directly buys the item

shopmenu items will have names shown when bough (You have successfully purchased <this item name>)

fixed ActiveWeaponOffset -> MyWeaponsOffset now weapons can go invisible

new native War3PrecacheSound( string ie "war3source/tomes.wav") precache the sound and adds to download list

added sound effects for undead suicide, buying tomes, entangle

1.0.0.6

blood mage, displays now many credits he stole

locust attack shows damage amount

fixed leech going over 150% 100 hp (TF/other mods)

adjusted blue shadow hunter ward color and undead suicide ring blue color

leech no longer make the victim lose extra hp, and victims will not have a message since it doesnt affect the victim's hp

fixed players switching to undead from another race and get suicide bomber on death

blood mage revival chance will now decrease and saturate at 2.5% times skilllevel (2.5-10 percent)

War3_ShowXP(client) native to print an the race and xp message

show xp after buying tomb

fixed undead suiciding when he doesnt have suicide bomber

fixed suicided bomber activating on dead ringer

fixed losing shopmenu items when activating dead ringer


you were robbed spelling in mage skill

changed a few centerprints and hintprints in all races

commands are now non-blocking, so war3 commands u say will show up in chat for others to see (so they know there is such comand)

orc chain lightning beam width increased

adjusted undead distract chance 0 to 0.25

introduced suicide bomber damage dependence on level and linearly on distance: 66 - 275 DMG TF, 50-200 DMG for CS 

adjusted suicide bomber radius 200 - 300

adjusted undead hp leech percent 0.07-0.30

effect for suicide bomber blowing up: shake screen of victims nearby

fixed shadow hunter always protecting self inflicted damage even when voodo was not activated

increased fan of knives TF radius to 300

increased healing wards radius by 10 now 70


1.0.0.5 Ownz (DarkEnergy)
war3dev command to list war3 developers (currently hardcoded)

fixed locust ultimate cooldown not resetting after map change FS#52

reduced wards damage flash screen alpha by 10

reduced wards animation alpha for red (red blocks more view than blue)

adjusted shadow hunter healing wave distance more linear 0-150(lvl1)-600(lvl4)

big bad voodoo now blocks self inflicted damage (side effect? no rocket/sticky jumping?)

mask of death (hp leech) TF2 is now capped to max hp of 1.5x normal (like original tf2 buff max), other mods max of original max health
IT IS RECOMMENDED THAT U SET sm_cvar tf_boost_drain_time 99999 so that exess hp is not lost if a medic heals them

revival now has minimum decay to 10% revival chance, so blood mages are still useful after so many revives...
decreased blood mage revival delay, maybe this could fix the stuck problem...by spawning them faster

locust now targets closest enemy (used to always attack the last person)